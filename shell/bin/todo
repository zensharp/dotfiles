#!/usr/bin/env bash

function visit
{
	dir=$(realpath $1)
	file=$dir/todo.md
	
	if [ -f "$file" ]
	then
		echo $file
		return 0
	fi

	next=$(realpath $dir/..)
	if [ "$next" == "$dir" ]
	then
		return -1
	fi

	visit $next
}

function addArgument
{
	args="$args $@"
}

# Begin script
global=false
while test $# -gt 0
do
	value="$1"
	case "$value" in
		-g|--global)
			global=true
			;;
		*)
			addArgument "$value"
			;;
	esac
	shift
done

if $global
then
	file=$TODO
else
	file=$(visit $PWD)
	if [ -z "$file" ]
	then
		file=$TODO
	fi
fi

if [ -z "$file" ]
then
	echo "No task file found"
else
	$EDITOR $file
fi
